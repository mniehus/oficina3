

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modelling &mdash; oficina3  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            oficina3
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">oficina3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">LEFA Oficina 3 – Laboratório de Estimação e Controlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html#lefa-oficina-3-estimation-and-control-lab">LEFA Oficina 3 – Estimation and Control Lab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projeto 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../project1/aeropendulum.html">Projeto 1: Desenvolvimento e Teste de um Aeropêndulo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/analogies.html">Analogias</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/pendulum-theory.html">Pendulum (theory)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/motorDC-theory.html">Motor DC (theory)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/motorDC-lab.html">Motor DC (drive)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/encoder.html">Encoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/stateMachine.html">State machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/controller.html">Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project1/integration.html">Integração do Sistema Arduino no Aeropêndulo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projeto 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../project2/readme.html">Carro programável</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Inverted Pendulum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">oficina3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Modelling</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/project3/sim/modelling2.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Modelling">
<h1>Modelling<a class="headerlink" href="#Modelling" title="Link to this heading"></a></h1>
<p>The simulation involves modeling the dynamics of a Reaction Wheel Inverted Pendulum (RWIP) system. The key components include:</p>
<p><strong>Reaction Wheel Inverted Pendulum Dynamics</strong></p>
<p><img alt="4d4dcbce4f9d45508a3f00247d070ff7" class="no-scaled-link" src="https://github.com/B-Paweekorn/Reaction-wheel-inverted-pendulum/assets/122732439/6c59b7a7-6aa7-4a73-b353-9e242e6aae1c" style="width: 480px;" /></p>
<p>RWIP Parameter</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">L1</span></code> - Pendulum length from orgin to center of mass</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">L2</span></code> - Pendulum length</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m1</span></code> - Mass of pendulum</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m2</span></code> - Mass of fly wheel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">θp</span></code> - Angle of pendulum</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">θr</span></code> - Angle of fly wheel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">I1</span></code> - Innertia moment of pendulum</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">I2</span></code> - Innertia moment fly wheel and Innertia moment of motor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">g</span></code> - Gravitational acceleration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tm</span></code> - Torque apply by DC motor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Td</span></code> - Disturbance</p></li>
</ul>
<p>Kinetic Energy</p>
<p>  <span class="math notranslate nohighlight">\(K = \frac{1}{2}(m_{1}L_{1}^{2}+m_{2}L_{2}^{2}+I_{1})\dot{θ_p}^{2} + \frac{1}{2}I_{2}(\dot{θ_p}+\dot{θ_r})^{2}\)</span></p>
<p>  <span class="math notranslate nohighlight">\(K = \frac{1}{2}(m_{1}L_{1}^{2}+m_{2}L_{2}^{2}+I_{1}+I_{2})\dot{θ_p}^{2} + I_{2}\dot{θ_p}\dot{θ_r} + \frac{1}{2}I_{2}\dot{θ_r}^{2}\)</span></p>
<p>Potential Energy</p>
<p>  <span class="math notranslate nohighlight">\(V = (m_1L + m_2L)g\cosθ_p\)</span></p>
<p>Lagrange Method</p>
<p>  <span class="math notranslate nohighlight">\(\frac{d}{dt} \left( \frac{\partial L}{\partial \dot{θ_r}} \right) - \frac{\partial L}{\partial θ_r} = 0\)</span>    and</p>
<p>  <span class="math notranslate nohighlight">\(\frac{d}{dt} \left( \frac{\partial L}{\partial \dot{θ_p}} \right) - \frac{\partial L}{\partial θ_p} = T_m\)</span></p>
<p>  Where Lagrangian (L) is</p>
<p>  <span class="math notranslate nohighlight">\(L = K - V\)</span></p>
<p>Mathematical equations of RWIP is described as</p>
<p>  <span class="math notranslate nohighlight">\(\ddot{\theta_p} = \frac{m_{1}gL_{1}\sin\left(\theta_{p}\right)\ +\ m_{2}gL_{2}\sin\left(\theta_{p}\right)\ -\ T_{m} +\ T_{d}}{m_{1}L_{1}^{2}+m_{2}L_{2}+I_{1}}\)</span></p>
<p>  <span class="math notranslate nohighlight">\(\ddot{\theta_r} = \frac{T_{r}}{I_{2}}\-\frac{m_{1}gL_{1}\ +\ m_{2}gL_{2}\ -\ T_{m} +\ T_{d}}{m_{1}L_{1}^{2}+m_{2}L_{2}+I_{1}}\)</span></p>
<p><strong>DC Motor Dynamics</strong></p>
<p><img alt="b9ff3772906e407388c9e58791acb99e" class="no-scaled-link" src="https://github.com/B-Paweekorn/Reaction-wheel-inverted-pendulum/assets/122732439/482f83f0-a4d7-4a70-b65e-006408f06a36" style="width: 480px;" /></p>
<p>Brushed DC Motor Parameter</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Vin</span></code> - Input Voltage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">R</span></code> - Motor resistance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">L</span></code> - Motor inductance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code> - Motor current</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">B</span></code> - Motor damped</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">J</span></code> - Motor rotor Innertia</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ke</span></code> - Back EMF constant</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kt</span></code> - Torque constant</p></li>
</ul>
<p>Electrical part</p>
<p>  <span class="math notranslate nohighlight">\(Vin = R i + L \frac{di}{dt} + k_e θ_r\)</span></p>
<p>Mechanical Part</p>
<p>  <span class="math notranslate nohighlight">\(T_{m} = Bθ_r + J\frac{\dot{θ_r}}{dt}\)</span></p>
<p>  <span class="math notranslate nohighlight">\(T_{m} = k_t i\)</span></p>
<section id="Controllers">
<h2>Controllers<a class="headerlink" href="#Controllers" title="Link to this heading"></a></h2>
<ul>
<li><p><strong>LQR Controller</strong>: A linear quadratic regulator designed to stabilize the pendulum in the upright position.</p>
<p>#### Linearization dynamics model ####</p>
<ul>
<li><p><strong>Part RWIP</strong></p>
<p>when sinθp -&gt; 0 sinθp = θp</p>
</li>
</ul>
<p>    <span class="math notranslate nohighlight">\(\ddot{\theta_p} = \frac{m_{1}gL_{1}\theta_{p}\ +\ m_{2}gL_{2}\theta_{p}\ -\ T_{m} +\ T_{d}}{m_{1}L_{1}^{2}+m_{2}L_{2}+I_{1}}\)</span></p>
<p>    <span class="math notranslate nohighlight">\(\ddot{\theta_r} = \frac{T_{m}}{I_{2}}\-\frac{m_{1}gL_{1}\ +\ m_{2}gL_{2}\ -\ T_{m} +\ T_{d}}{m_{1}L_{1}^{2}+m_{2}L_{2}+I_{1}}\)</span></p>
<ul class="simple">
<li><p><strong>Part Motor</strong></p></li>
</ul>
<p>   We can estimate that L &lt;&lt; R</p>
<p>    <span class="math notranslate nohighlight">\(Vin = R i + k_e θ_r\)</span></p>
<p>    <span class="math notranslate nohighlight">\(T_{m} = k_t i\)</span></p>
<p>#### State space ####</p>
<p>The proceeding equations are valid around the operating point where θp = 0</p>
</li>
</ul>
<p>      <img alt="Matrix" src="https://latex.codecogs.com/svg.image?%5Cbegin%7Bbmatrix%7D%5Cdot%7B%5Ctheta_p%7D%5C%5C%5Cddot%7B%5Ctheta_p%7D%5C%5C%5Cdot%7B%5Ctheta_r%7D%5C%5C%5Cddot%7B%5Ctheta_r%7D%5Cend%7Bbmatrix%7D=%5Cbegin%7Bbmatrix%7D0&amp;1&amp;0&amp;0%5C%5C%5Cfrac%7B(m_1L_1+m_2L_2)g%7D%7Bm_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+J%7D&amp;0&amp;0&amp;%5Cfrac%7Bk_tk_e%7D%7B(m_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+J)R%7D%5C%5C0&amp;0&amp;0&amp;1%5C%5C-%5Cfrac%7B(m_1L_1+m_2L_2)g%7D%7Bm_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+J%7D&amp;0&amp;0&amp;-(%5Cfrac%7Bm_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+2J%7D%7B(m_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+J)J%7D)(%5Cfrac%7Bk_tk_e%7D%7BR%7D)%5C%5C%5Cend%7Bbmatrix%7D%5Cbegin%7Bbmatrix%7D%5Ctheta_p%5C%5C%5Cdot%7B%5Ctheta_p%7D%5C%5C%5Ctheta_r%5C%5C%5Cdot%7B%5Ctheta_r%7D%5Cend%7Bbmatrix%7D+%5Cbegin%7Bbmatrix%7D0%5C%5C%5Cfrac%7Bk_t%7D%7B(m_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+J)R%7D%5C%5C0%5C%5C(%5Cfrac%7Bm_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+2J%7D%7B(m_1L_1%5E%7B2%7D+m_2L_2%5E%7B2%7D+J)J%7D)(%5Cfrac%7Bkt%7D%7BR%7D)%5Cend%7Bbmatrix%7DV_%7Bin%7D" /></p>
<ul>
<li><p><strong>PID Controller</strong>: The stabilize controller to compare with LQR #### Transfer function ####</p>
<p>    <span class="math notranslate nohighlight">\(\Large\frac{\theta_{p}(s)}{\tau_{m}(s)}=\frac{\frac{s}{-J-m_{2}L_{2}^{2}}}{s^{3}+\left(\frac{B}{I_{1}}+\frac{B+d_{p}}{J+m_{2}L_{2}^{2}}\right)s^{2}-\left(\frac{\left(m_{1}L_{1}+m_{2}L_{2}\right)g}{\left(J+m_{2}L_{2}^{2}\right)I_{1}}-\frac{B\cdot d_{p}}{\left(J+m_{2}L_{2}^{2}\right)I_{1}}\right)s-\frac{\left(m_{1}L_{1}+m_{2}L_{2}\right)Bg}{\left(J+m_{2}L_{2}^{2}\right)I_{1}}}\)</span></p>
<p class="rubric" id="root-locus-design">Root Locus Design</p>
<p>To predict the system’s characteristics as the gain (Kp) is adjusted and poles move, design the root locus.</p>
<p>    <img alt="image" src="https://github.com/B-Paweekorn/Reaction-wheel-inverted-pendulum/assets/122732439/76fc37ed-f049-4606-9711-ea4dd4a56246" /></p>
<p>Root Locus of the system by default parameter set. It has one zero (s = 0), and three poles (s = -74.93; s =-3.88e-3; s = 73.53).</p>
<p class="rubric" id="closed-loop-root-locus">Closed Loop Root Locus</p>
<p>    <img alt="image1" src="https://github.com/B-Paweekorn/Reaction-wheel-inverted-pendulum/assets/122732439/31d1765a-d515-48da-8024-f94bcc96d6e3" /></p>
<p>  Where G(s) is Kp the gain can be adjusted ti make the closed loop poles to be in stable location The resultant Root Locus can be seen below (note to plot this graph in <code class="docutils literal notranslate"><span class="pre">param.py</span></code> you need to set <code class="docutils literal notranslate"><span class="pre">Stabilize_Controller</span></code> to “PID” mode and set <code class="docutils literal notranslate"><span class="pre">plot_rootlocus</span></code> to “True”) in this graph you can click pole position you want to know Gain <code class="docutils literal notranslate"><span class="pre">Kp</span></code> to adjust your system characteristics.</p>
<p>   <img alt="image2" src="https://github.com/B-Paweekorn/Reaction-wheel-inverted-pendulum/assets/122732439/692a1848-401b-4212-887d-eaeb9cc49548" /></p>
</li>
<li><p><strong>Bang-bang Controller</strong>: The swing up control routine and the stabilizing control routine are switched between -25 to 25 degree</p></li>
</ul>
<p>   <img alt="85e6a32af02a4b6c8098cbae9b70a5c4" class="no-scaled-link" src="https://github.com/B-Paweekorn/Reaction-wheel-inverted-pendulum/assets/122732439/79e6d6d3-9ab2-49eb-a58b-3ad10a96a96b" style="width: 480px;" /></p>
<ul class="simple">
<li><p><strong>Brake Controller</strong>: Used as reduced energy of RWIP when RWIP have too much energy for stabilze</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, mniehus.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>