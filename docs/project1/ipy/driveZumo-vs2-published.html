

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modelo de movimento diferencial com dois motores e codificadores rotacionais &mdash; oficina3  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            oficina3
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">oficina3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">LEFA Oficina 3 – Laboratório de Estimação e Controlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html#lefa-oficina-3-estimation-and-control-lab">LEFA Oficina 3 – Estimation and Control Lab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projeto 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aeropendulum.html">Projeto 1: Desenvolvimento e Teste de um Aeropêndulo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analogies.html">Analogias</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pendulum-theory.html">Aeropendulum (theory)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motorDC-theory.html">Motor DC (theory)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motorDC-lab.html">Motor DC (drive)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../encoder.html">Encoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coding.html">Programar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motorCalib-PT.html">[PT] Máquinas de Estados aplicadas à Calibração de Motor DC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motorCalib-EN.html">[EN] State-Machines applied to DC Motor Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-intro.html">Sistema / Processo / ‘Plant’</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-intro.html#Controlador">Controlador</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-intro.html#Requisitos-do-sistema:-que-caraterísticas-para-a-saída?">Requisitos do sistema: que caraterísticas para a saída?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-intro.html#Controlador-em-malha-fechada">Controlador em malha fechada</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-intro.html#Controlo-de-limiar-('bang-bang'-ou-'on/off')-com-Arduino">Controlo de limiar (‘bang-bang’ ou ‘on/off’) com Arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-intro.html#Referência">Referência</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller.html">PID Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-PID-arduino.html">Controlador PID no arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-PID-arduino.html#Afinar-os-coeficientes-PID-(PID-tuning)">Afinar os coeficientes PID (PID tuning)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-PID-arduino.html#Procedimento-/-Metodologia-para-ajuste-manual">Procedimento / Metodologia para ajuste manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-PID-arduino.html#Exemplo-de-implementação-de-controlador-PID-em-Arduino">Exemplo de implementação de controlador PID em Arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-PID-arduino.html#Código-de-controlador-PID-para-arduino-(com-biblioteca)">Código de controlador PID para arduino (com biblioteca)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlo-ref-code-aeropendulo.html">Código de referência para aeropendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integration.html">Integração do Sistema</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projeto 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../project2/readme.html">Carro programável</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../project3/readme.html">Inverted Pendulum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">oficina3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Modelo de movimento diferencial com dois motores e codificadores rotacionais</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/project1/ipy/driveZumo-vs2-published.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal python mathy code</span>
<span class="c1"># Import Libraries:</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.animation</span><span class="w"> </span><span class="kn">import</span> <span class="n">FFMpegWriter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circle</span>
</pre></div>
</div>
</div>
<section id="Modelo-de-movimento-diferencial-com-dois-motores-e-codificadores-rotacionais">
<h1>Modelo de movimento diferencial com dois motores e codificadores rotacionais<a class="headerlink" href="#Modelo-de-movimento-diferencial-com-dois-motores-e-codificadores-rotacionais" title="Link to this heading"></a></h1>
<p>Para conduzir um robô de rastreio (‘tracking robot’) com dois motores (um motor à esquerda e outro à direita), controlamos a velocidade de cada roda para definir a trajetória do robô no plano $ (x, y) $. Neste tipo de robôs diferenciais, o movimento é determinado pela diferença de velocidade entre as rodas esquerda e direita.</p>
<section id="Modelação-do-Movimento-do-Robô-no-Plano-$-(x,-y)-$">
<h2>Modelação do Movimento do Robô no Plano $ (x, y) $<a class="headerlink" href="#Modelação-do-Movimento-do-Robô-no-Plano-$-(x,-y)-$" title="Link to this heading"></a></h2>
<p>Suponhamos que:</p>
<ul class="simple">
<li><p>$ v_L $ é a velocidade linear da roda esquerda,</p></li>
<li><p>$ v_R $ é a velocidade linear da roda direita,</p></li>
<li><p>$ R $ é o raio da roda,</p></li>
<li><p>$ d $ é a distância entre as rodas esquerda e direita (a base do robô).</p></li>
</ul>
</section>
<section id="Velocidade-Linear-e-Rotacional-do-Robô">
<h2>Velocidade Linear e Rotacional do Robô<a class="headerlink" href="#Velocidade-Linear-e-Rotacional-do-Robô" title="Link to this heading"></a></h2>
<p>A velocidade linear <span class="math notranslate nohighlight">\(v\)</span> do robô (no centro do eixo entre as rodas) e a velocidade angular $ :nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>omega <a href="#id3"><span class="problematic" id="id4">`</span></a>$ (rotações por segundo) em torno do centro do robô são dadas por:</p>
<div class="math notranslate nohighlight">
\[v = \frac{v_L + v_R}{2}\]</div>
<div class="math notranslate nohighlight">
\[\omega = \frac{v_R - v_L}{d}\]</div>
</section>
<section id="Equações-de-Movimento-no-Plano">
<h2>Equações de Movimento no Plano<a class="headerlink" href="#Equações-de-Movimento-no-Plano" title="Link to this heading"></a></h2>
<p>Se o robô começa num ponto inicial $ (x_0, y_0) $ com uma orientação inicial $ <span class="math">\theta</span>_0 $ (ângulo em relação ao eixo $ x $), a posição do robô no tempo $ t $ pode ser calculada integrando a velocidade e a rotação ao longo do tempo. As equações de movimento são:</p>
<div class="math notranslate nohighlight">
\[x(t) = x_0 + \int_0^t v \cos(\theta(\tau)) \, d\tau\]</div>
<div class="math notranslate nohighlight">
\[y(t) = y_0 + \int_0^t v \sin(\theta(\tau)) \, d\tau\]</div>
<div class="math notranslate nohighlight">
\[\theta(t) = \theta_0 + \int_0^t \omega \, d\tau\]</div>
</section>
<section id="Implementação-Discreta">
<h2>Implementação Discreta<a class="headerlink" href="#Implementação-Discreta" title="Link to this heading"></a></h2>
<p>Para uma implementação discreta (em intervalos de tempo $ :nbsphinx-math:<a href="#id5"><span class="problematic" id="id6">`</span></a>Delta <a href="#id7"><span class="problematic" id="id8">`</span></a>t $), podemos aproximar estas integrais para atualizar o estado do robô em cada instante $ k $:</p>
<div class="math notranslate nohighlight">
\[x_{k+1} = x_k + v \cos(\theta_k) \Delta t\]</div>
<div class="math notranslate nohighlight">
\[y_{k+1} = y_k + v \sin(\theta_k) \Delta t\]</div>
<div class="math notranslate nohighlight">
\[\theta_{k+1} = \theta_k + \omega \Delta t\]</div>
</section>
<section id="Incorporar-codificadores">
<h2>Incorporar codificadores<a class="headerlink" href="#Incorporar-codificadores" title="Link to this heading"></a></h2>
<p>Para incorporar as medições de velocidade usando os codificadores da roda esquerda e direita, precisamos entender que a velocidade de cada roda é determinada a partir das contagens dos codificadores em intervalos de tempo específicos. Cada codificador mede o número de “pulsos” ou “contagens” que ocorrem enquanto a roda gira, o que nos permite calcular a distância percorrida por cada roda e, portanto, a velocidade.</p>
<p>Vamos supor:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N_L\)</span> e <span class="math notranslate nohighlight">\(N_R\)</span> são as contagens de pulsos dos codificadores da roda esquerda e da roda direita, respetivamente, durante o intervalo de tempo $ :nbsphinx-math:<a href="#id9"><span class="problematic" id="id10">`</span></a>Delta <a href="#id11"><span class="problematic" id="id12">`</span></a>t $.</p></li>
<li><p><span class="math notranslate nohighlight">\(P\)</span> é o número de impulsos por rotação completo da roda (resolução do codificador).</p></li>
<li><p><span class="math notranslate nohighlight">\(R\)</span> é o raio de cada roda.</p></li>
</ul>
<p>Para o robot Zumo, o valor de <span class="math notranslate nohighlight">\(P\)</span>, o número de impulsos por rotação completo da roda (resolução do codificador), pode ser obtido da documentação online em: <a class="reference external" href="https://www.pololu.com/docs/0J63/3.4">https://www.pololu.com/docs/0J63/3.4</a> $P = 900 CPR = 75 <span class="math">\cdot 12</span> CPR $ em que <span class="math notranslate nohighlight">\(CPR\)</span> são as contagens por revolução do eixo, <span class="math notranslate nohighlight">\(75\)</span> é o fator de redução da engrenagem mecânica entre o eixo da roda e o eixo do motor elétrico, e <span class="math notranslate nohighlight">\(12\)</span> CPR as contagens de impulsos por rotação do eixo do motor.</p>
<p>O raio da roda <span class="math notranslate nohighlight">\(R\)</span> pode ser medido ou estimado da informação disponivel, é é o raio de cada roda.</p>
<p>Em alternativa, podem determinar em laboratório qual o incremento dos contadores para cada centímetro de movimento.</p>
<p>Seja qual o método de definir estes parâmetros, eles nunca serão ‘perfeitos’, ou seja, estarão associados a uma inverteza ou um ‘erro’ que deve ser mantida tão pequeno quanto possível, no entanto, nunca poderá ser eliminado. Como se vai ver adiante, esta incerteza introduz incerteza no control do movimento e estimação de velocidade e posição.</p>
<p>A distância percorrida por cada roda durante $ <span class="math">\Delta `t $ pode ser obtida a partir da contagem de pulsos e da circunferência da roda ($ 2 :nbsphinx-math:</span>pi <cite>R $). Se $ N_L $ e $ N_R $ são as contagens de pulsos para a roda esquerda e direita, respetivamente, e $ :nbsphinx-math:</cite>Delta <cite>N_L $ e $:nbsphinx-math:</cite>Delta  <cite>N_R $ a variação das contagens desde a última medida, então a distância percorrida por cada roda ($ d_L $ para a roda esquerda e $ d_R $ para a direita) no
intervalo de temp :math:`dt</cite> é:</p>
<div class="math notranslate nohighlight">
\[\Delta d_L = \frac{\Delta N_L}{P} \cdot 2 \pi R\]</div>
<div class="math notranslate nohighlight">
\[\Delta d_R = \frac{\Delta N_R}{P} \cdot 2 \pi R\]</div>
<p>As velocidades lineares de cada roda, $ v_L $ e $ v_R $, são então dadas por:</p>
<div class="math notranslate nohighlight">
\[v_L = \frac{\Delta d_L}{\Delta t} = \frac{\Delta N_L}{P} \cdot \frac{2 \pi R}{\Delta t}\]</div>
<div class="math notranslate nohighlight">
\[v_R = \frac{\Delta d_R}{\Delta t} = \frac{\Delta N_R}{P} \cdot \frac{2 \pi R}{\Delta t}\]</div>
</section>
<section id="Planeamento-do-Movimento-no-Plano">
<h2>Planeamento do Movimento no Plano<a class="headerlink" href="#Planeamento-do-Movimento-no-Plano" title="Link to this heading"></a></h2>
<p>Para conduzir o robô do ponto inicial ao ponto final, respeitando a orientação inicial e a orientação final desejada, podemos dividir o movimento em três etapas:</p>
<ol class="arabic simple">
<li><p><strong>Rotação Inicial</strong>: Alinhar o robô na direção do ponto final.</p></li>
<li><p><strong>Translação</strong>: Mover em linha reta até o ponto final.</p></li>
<li><p><strong>Rotação Final</strong>: Ajustar a orientação para a orientação final desejada.</p></li>
</ol>
<p>Suponhamos que:</p>
<ul class="simple">
<li><p>$ (x_0, y_0) $ e $ <span class="math">\theta</span>_0 $ representam a posição e orientação iniciais do robô.</p></li>
<li><p>$ (x_f, y_f) $ e $ <span class="math">\theta</span>_f $ representam a posição e orientação finais desejadas do robô.</p></li>
<li><p>A distância entre as rodas do robô é $ d $, e o controle é feito ajustando as velocidades angulares das rodas esquerda e direita.</p></li>
</ul>
<section id="Rotação-Inicial">
<h3>Rotação Inicial<a class="headerlink" href="#Rotação-Inicial" title="Link to this heading"></a></h3>
<p>Primeiro, precisamos alinhar o robô na direção do ponto final $ (x_f, y_f) $.</p>
<ol class="arabic">
<li><p><strong>Cálculo do Ângulo de Direção</strong>: Calcule o ângulo de orientação desejada, $ <span class="math">\theta</span>_d $, entre o ponto inicial $ (x_0, y_0) $ e o ponto final $ (x_f, y_f) $:</p>
<div class="math notranslate nohighlight">
\[\theta_d = \arctan\left(\frac{y_f - y_0}{x_f - x_0}\right)\]</div>
</li>
<li><p>**Rotação até $ <span class="math">\theta</span>_d $**: Ajuste a velocidade angular $ <span class="math">\omega `$ do robô para alinhar a orientação atual $ :nbsphinx-math:</span>theta`_0 $ com $ <span class="math">\theta</span>_d $. A rotação pode ser feita definindo as velocidades das rodas esquerda e direita, $ v_L $ e $ v_R $, com sinais opostos:</p>
<ul class="simple">
<li><p>Se $ <span class="math">\theta</span>_0 &lt; <span class="math">\theta</span>_d $, rode o robô no sentido anti-horário.</p></li>
<li><p>Se $ <span class="math">\theta</span>_0 &gt; <span class="math">\theta</span>_d $, rode o robô no sentido horário.</p></li>
</ul>
<p>A rotação é realizada com:</p>
<div class="math notranslate nohighlight">
\[v_L = -v \quad \text{e} \quad v_R = v\]</div>
<p>onde $ v $ é a velocidade desejada, de modo a gerar uma velocidade angular constante $ <span class="math">\omega `= :nbsphinx-math:</span>frac{2v}{d}` $ até que o robô atinja $ <span class="math">\theta</span>_d $.</p>
</li>
</ol>
</section>
<section id="Translação-em-Linha-Reta-até-o-Ponto-Final">
<h3>Translação em Linha Reta até o Ponto Final<a class="headerlink" href="#Translação-em-Linha-Reta-até-o-Ponto-Final" title="Link to this heading"></a></h3>
<p>Uma vez alinhado na direção do ponto final, o robô pode mover-se em linha reta até o ponto $ (x_f, y_f) $.</p>
<ol class="arabic">
<li><p><strong>Distância até o Ponto Final</strong>: Calcule a distância $ d_f $ entre a posição atual $ (x, y) $ e o ponto final $ (x_f, y_f) $:</p>
<div class="math notranslate nohighlight">
\[d_f = \sqrt{(x_f - x)^2 + (y_f - y)^2}\]</div>
</li>
<li><p><strong>Movimento em Linha Reta</strong>: Mova o robô para frente com uma velocidade linear constante $ v $ até percorrer a distância $ d_f $. Durante este movimento, a velocidade angular deve ser zero para manter o robô na linha reta:</p>
<div class="math notranslate nohighlight">
\[v_L = v \quad \text{e} \quad v_R = v\]</div>
<p>Continue o movimento até que a posição atual do robô atinja o ponto $ (x_f, y_f) $.</p>
</li>
</ol>
</section>
<section id="Rotação-Final">
<h3>Rotação Final<a class="headerlink" href="#Rotação-Final" title="Link to this heading"></a></h3>
<p>Finalmente, o robô deve ajustar a sua orientação para o ângulo final desejado $ <span class="math">\theta</span>_f $.</p>
<ol class="arabic">
<li><p><strong>Diferença de Orientação</strong>: Calcule a diferença angular $ <span class="math">\Delta `:nbsphinx-math:</span>theta <cite>$ entre a orientação atual $ :nbsphinx-math:</cite>theta <cite>$ e a orientação final $ :nbsphinx-math:</cite>theta`_f $:</p>
<div class="math notranslate nohighlight">
\[\Delta \theta = \theta_f - \theta\]</div>
</li>
<li><p>**Rotação para $ <span class="math">\theta</span>_f $**: Ajuste novamente as velocidades das rodas com sinais opostos para criar uma rotação até que a orientação atual coincida com $ <span class="math">\theta</span>_f $.</p>
<ul class="simple">
<li><p>Se $ <span class="math">\theta `< :nbsphinx-math:</span>theta`_f $, rode o robô no sentido anti-horário.</p></li>
<li><p>Se $ <span class="math">\theta `> :nbsphinx-math:</span>theta`_f $, rode o robô no sentido horário.</p></li>
</ul>
<p>A rotação final é realizada com:</p>
<div class="math notranslate nohighlight">
\[v_L = -v \quad \text{e} \quad v_R = v\]</div>
<p>até que o ângulo do robô seja igual a $ <span class="math">\theta</span>_f $.</p>
</li>
</ol>
<section id="Conduzir-um-segmento-linear">
<h4>Conduzir um segmento linear<a class="headerlink" href="#Conduzir-um-segmento-linear" title="Link to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Parâmetros do robô</span>
<span class="n">v_linear</span> <span class="o">=</span> <span class="mf">1.0</span>        <span class="c1"># Velocidade linear (m/s)</span>
<span class="n">v_angular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>   <span class="c1"># Velocidade angular (rad/s)</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>              <span class="c1"># Intervalo de tempo (s)</span>

<span class="c1"># Coordenadas e orientações iniciais e finais</span>
<span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">theta0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>           <span class="c1"># Ponto inicial e orientação inicial</span>
<span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">thetaf</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>         <span class="c1"># Ponto final e orientação final</span>

<span class="c1"># Inicialização das variáveis</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">theta0</span>
<span class="n">trajectory_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">trajectory_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

<span class="c1"># 1. Rotação inicial para alinhar o robô na direção do ponto final</span>
<span class="n">theta_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">yf</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">xf</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
<span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">theta_d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># Até atingir a orientação desejada</span>
    <span class="k">if</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="n">theta_d</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">+=</span> <span class="n">v_angular</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">-=</span> <span class="n">v_angular</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">trajectory_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">trajectory_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># 2. Translação em linha reta até o ponto final</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xf</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yf</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="k">while</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># Até atingir o ponto final</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">v_linear</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">y</span> <span class="o">+=</span> <span class="n">v_linear</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xf</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yf</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">trajectory_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">trajectory_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># 3. Rotação final para atingir a orientação final desejada</span>
<span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">thetaf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># Até atingir a orientação final</span>
    <span class="k">if</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="n">thetaf</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">+=</span> <span class="n">v_angular</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">-=</span> <span class="n">v_angular</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">trajectory_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">trajectory_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Plot da trajetória</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trajectory_x</span><span class="p">,</span> <span class="n">trajectory_y</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trajetória do robô&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">xf</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">yf</span><span class="p">],</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pontos inicial e final&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta0</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Orientação inicial&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetaf</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetaf</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Orientação final&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Simulação do Movimento do Robô&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/project1_ipy_driveZumo-vs2-published_4_0.png" src="../../_images/project1_ipy_driveZumo-vs2-published_4_0.png" />
</div>
</div>
</section>
<section id="Conduzir-uma-trajetória-fechada">
<h4>Conduzir uma trajetória fechada<a class="headerlink" href="#Conduzir-uma-trajetória-fechada" title="Link to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="c1">#from matplotlib.animation import FuncAnimation</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[221]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parâmetros do robô</span>
<span class="n">d</span><span class="o">=</span><span class="mi">10</span> <span class="c1">#cm, distancia entre rodas</span>

<span class="c1"># controlo de velocidade (da calibração)</span>
<span class="n">pwm_max</span><span class="o">=</span><span class="mi">400</span> <span class="c1">#unidade?</span>
<span class="n">vmax</span><span class="o">=</span><span class="mi">10</span> <span class="c1">#cm/s, with pwm_max applied to left and right motor</span>
<span class="n">wmax</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">vmax</span><span class="o">/</span><span class="n">d</span> <span class="c1"># rad/s, with pwm_max applied to right motor and -pwm_max to left motor</span>

<span class="n">pwm</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span><span class="c1">#valor usado para pwm &#39;speed&#39;</span>

<span class="n">vapp</span> <span class="o">=</span> <span class="n">vmax</span><span class="o">*</span><span class="n">pwm</span><span class="o">/</span><span class="n">pwm_max</span>   <span class="c1"># Velocidade linear aplicada (cm/s)</span>
<span class="n">wapp</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">vapp</span><span class="o">/</span><span class="n">d</span>   <span class="c1"># Velocidade angular aplicada (rad/s)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[546]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># coordenadas de vertices (&#39;waypoints&#39;) de trajetoria alvo</span>

<span class="n">wps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Fechar a trajetoria</span>
<span class="n">wps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wps</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x (cm)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y (cm)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Waypoint trajectory&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/project1_ipy_driveZumo-vs2-published_8_0.png" src="../../_images/project1_ipy_driveZumo-vs2-published_8_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[548]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Função para atualizar a posição e orientação do robô para cada segmento da trajetória</span>
<span class="k">def</span><span class="w"> </span><span class="nf">move_robot</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">x_start</span><span class="p">,</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">theta_start</span><span class="p">,</span> <span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span><span class="p">,</span> <span class="n">theta_end</span><span class="p">):</span>

    <span class="n">trajectory</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">global</span> <span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">theta</span>

    <span class="n">t</span><span class="o">=</span><span class="n">t_start</span>
    <span class="n">v</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">w</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x_start</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y_start</span>
    <span class="n">theta</span><span class="o">=</span><span class="n">theta_start</span>

    <span class="c1"># 1. Rotação inicial para alinhar com o ponto final</span>
    <span class="n">w</span><span class="o">=</span><span class="n">wapp</span>
    <span class="n">theta_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y_end</span> <span class="o">-</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">x_end</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span>
    <span class="n">dtheta_before</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">theta_d</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="c1">#arbitrar valor anterior ao inicial</span>

    <span class="c1">#print(&#39;first&#39;)</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">theta_d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">theta_d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dtheta_before</span><span class="p">:</span>  <span class="c1"># Até atingir a orientação desejada</span>
        <span class="n">dtheta_before</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">theta_d</span><span class="p">)</span>
        <span class="n">t</span><span class="o">+=</span><span class="n">dt</span>
        <span class="k">if</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="n">theta_d</span><span class="p">:</span>
            <span class="n">w</span><span class="o">=</span><span class="n">wapp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">wapp</span>
        <span class="n">theta</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">theta</span><span class="p">))</span>

    <span class="c1"># 2. Translação em linha reta até o ponto final</span>
    <span class="n">v</span><span class="o">=</span><span class="n">vapp</span>
    <span class="n">w</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_end</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_end</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">distance_before</span><span class="o">=</span><span class="n">distance</span><span class="o">+</span><span class="mi">1</span>  <span class="c1">#arbitrar valor anterior</span>
    <span class="c1">#print(&#39;second&#39;)</span>
    <span class="k">while</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="ow">and</span> <span class="n">distance</span><span class="o">&lt;</span><span class="n">distance_before</span><span class="p">:</span>  <span class="c1"># Até atingir o ponto final</span>
        <span class="c1">#print(distance)</span>
        <span class="n">distance_before</span><span class="o">=</span><span class="n">distance</span>
        <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="n">dt</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_d</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_d</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">theta</span><span class="p">))</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_end</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_end</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    # 3. Rotação final para atingir a orientação final desejada</span>
<span class="sd">    v=0</span>
<span class="sd">    w=wapp</span>
<span class="sd">    dtheta_before=abs(theta - theta_end)+1   #arbitrar valor anterior</span>
<span class="sd">    #print(&#39;third&#39;)</span>
<span class="sd">    while abs(theta - theta_end) &gt; 0.01 and abs(theta - theta_end) &lt; dtheta_before:  # Até atingir a orientação final</span>
<span class="sd">        #print(abs(theta - theta_end))</span>
<span class="sd">        t=t+dt</span>
<span class="sd">        if theta &lt; theta_end:</span>
<span class="sd">            w=wapp</span>
<span class="sd">        else:</span>
<span class="sd">            w=-wapp</span>
<span class="sd">        theta += w * dt</span>
<span class="sd">        trajectory.append((t,v,w,x,y,theta))</span>
<span class="sd">        dtheta_before=abs(theta - theta_end)</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">trajectory</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[550]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#start configuration</span>

<span class="n">t0</span><span class="o">=</span><span class="mi">0</span>  <span class="c1">#start time</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.05</span>             <span class="c1"># Intervalo de tempo (s)</span>

<span class="c1"># Inicialização da posição e orientação do robô</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">wps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">wps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">theta0</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Geração da trajetória completa para todos os segmentos</span>
<span class="n">full_trajectory</span><span class="o">=</span> <span class="p">[]</span>
<span class="n">full_trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">theta0</span><span class="p">))</span>

<span class="c1">#create movement along trajectory</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wps</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">t_start</span><span class="o">=</span><span class="n">full_trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x_start</span><span class="o">=</span><span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y_start</span><span class="o">=</span><span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x_end</span><span class="o">=</span><span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y_end</span><span class="o">=</span><span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">theta_start</span> <span class="o">=</span> <span class="n">theta0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">theta_start</span> <span class="o">=</span> <span class="n">theta_end_anterior</span>
    <span class="n">theta_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y_end</span> <span class="o">-</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">x_end</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span>
    <span class="n">segment_trajectory</span> <span class="o">=</span> <span class="n">move_robot</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">x_start</span><span class="p">,</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">theta_start</span><span class="p">,</span> <span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span><span class="p">,</span> <span class="n">theta_end</span><span class="p">)</span>
    <span class="n">full_trajectory</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">segment_trajectory</span><span class="p">)</span>
    <span class="n">theta_end_anterior</span><span class="o">=</span><span class="n">theta_end</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[552]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuração da figura e dos subplots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">t</span> <span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">full_trajectory</span><span class="p">]</span>  <span class="c1"># Eixo do tempo</span>
<span class="n">v</span> <span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">full_trajectory</span><span class="p">]</span>  <span class="c1">#velocidade linear</span>
<span class="n">w</span> <span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">full_trajectory</span><span class="p">]</span>  <span class="c1">#velocidade angular</span>
<span class="n">x</span> <span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">full_trajectory</span><span class="p">]</span>  <span class="c1">#posicao x</span>
<span class="n">y</span><span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">full_trajectory</span><span class="p">]</span>  <span class="c1">#posicao y</span>
<span class="n">theta</span> <span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">full_trajectory</span><span class="p">]</span>  <span class="c1">#orientacao teta</span>

<span class="c1"># Subplot 1:</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 2 linhas, 2 colunas, posição 1</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Velocidade linear e angular&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;v (cm/s), $\omega$(rad/s)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\omega$&#39;</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Subplot 2:</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>  <span class="c1"># 2 linhas, 2 colunas, posição 3</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Posição e orientação&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Tempo (s)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;x (cm), y (cm), $\Theta$ (rad)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\Theta$&#39;</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Subplot 3:</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># 1 linha, 2 colunas, posição 2</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wps</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">wps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Waypoints trajectory&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Posição x (cm)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Posição y (cm)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;WP1&#39;</span><span class="p">,</span><span class="s1">&#39;WP2&#39;</span><span class="p">,</span><span class="s1">&#39;WP3&#39;</span><span class="p">,</span><span class="s1">&#39;WP4&#39;</span><span class="p">,</span><span class="s1">&#39;WP5&#39;</span><span class="p">,</span><span class="s1">&#39;WP6=WP1&#39;</span><span class="p">,</span><span class="s1">&#39;Trajectory&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Ajustar espaçamento entre os subplots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/project1_ipy_driveZumo-vs2-published_11_0.png" src="../../_images/project1_ipy_driveZumo-vs2-published_11_0.png" />
</div>
</div>
</section>
<section id="Controlo-direto-('feedforward')---gerar-valores-PWM-para-Zumo">
<h4>Controlo direto (‘feedforward’) - gerar valores PWM para Zumo<a class="headerlink" href="#Controlo-direto-('feedforward')---gerar-valores-PWM-para-Zumo" title="Link to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[562]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parâmetros do robô</span>
<span class="n">d</span><span class="o">=</span><span class="mi">10</span> <span class="c1">#cm, distancia entre rodas</span>

<span class="c1"># controlo de velocidade</span>
<span class="n">pwm_max</span><span class="o">=</span><span class="mi">400</span> <span class="c1">#unidade?</span>
<span class="n">vmax</span><span class="o">=</span><span class="mi">10</span> <span class="c1">#cm/s, with pwm_max applied to left and right motor</span>
<span class="n">wmax</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">vmax</span><span class="o">/</span><span class="n">d</span> <span class="c1"># rad/s, with pwm_max applied to right motor and -pwm_max to left motor</span>

<span class="n">pwm_right</span><span class="o">=</span><span class="p">[]</span>
<span class="n">pwm_left</span><span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
    <span class="n">pwm_right</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pwm_max</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">pwm_left</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pwm_max</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">vmax</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pwm_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="c1">#ax1.set_title(&quot;PWM&quot;)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PWM RIGHT&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;right&#39;</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Subplot 2:</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pwm_left</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PWM LEFT&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;left&#39;</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#Store values in correct format for arduino array</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/project1_ipy_driveZumo-vs2-published_13_0.png" src="../../_images/project1_ipy_driveZumo-vs2-published_13_0.png" />
</div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, mniehus.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>