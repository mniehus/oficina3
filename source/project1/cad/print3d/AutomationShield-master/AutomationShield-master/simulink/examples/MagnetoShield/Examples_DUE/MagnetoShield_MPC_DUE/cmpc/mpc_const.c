#include "mpc_const.h" 

const real_t HoL[] = { /* Quadratic term (Hessian) matrix of QP over Lipschitz constant. */
0.5161769810350221, 0.222711477732566, 0.18031104419181834, 0.13992511407783836, 0.10066249145629173, 0.06151531388557085, 0.023360582935215687, 
0.222711477732566, 0.45222034901520447, 0.16509864588390913, 0.12783207100398838, 0.09153146583266844, 0.05567042379054779, 0.02106087369801032, 
0.18031104419181834, 0.16509864588390913, 0.40031262473125123, 0.11780810087475417, 0.08421602252443013, 0.050975873346850505, 0.019201586666475718, 
0.13992511407783836, 0.12783207100398838, 0.11780810087475416, 0.35722120909891314, 0.07805868254409216, 0.04725084117088027, 0.017732157634701623, 
0.10066249145629173, 0.09153146583266844, 0.08421602252443014, 0.07805868254409215, 0.32054919504104895, 0.04395078877294952, 0.01657218998679851, 
0.06151531388557085, 0.05567042379054779, 0.050975873346850505, 0.04725084117088027, 0.043950788772949514, 0.28882098041785226, 0.015399919812236939, 
0.023360582935215687, 0.02106087369801032, 0.019201586666475715, 0.017732157634701623, 0.016572189986798505, 0.015399919812236935, 0.26306214785878734, 
 
};
const real_t GoL[] = { /* Linear term matrix of the QP, over Lipschitz constant. */
1.9173428990211023, -2188.323982619054, -87.95930349451187, 32.8972508216169, 
1.0957644155044464, -1926.9895610038602, -73.0078973108332, 27.379184828358127, 
0.556918429246397, -1651.7915991132531, -59.23313381982491, 22.179153033883896, 
0.23557375666754332, -1353.9686203839697, -46.166396728113064, 17.247690899354716, 
0.07190509275151964, -1023.767306056168, -33.36285345308313, 12.436252149961115, 
0.010431395365379301, -653.2671832946468, -20.473242079280663, 7.615881567540912, 
0.0, -256.2874548140115, -7.80007940400277, 2.8969263844565436, 

};
const real_t Bh_T[] = { /* Extended input matrix (used for reference tracking). */
0.0, -2.07975654e-06, -0.00183802608, 0.00389551218, 2.07975654e-06, -1.0176544721586535e-05, -0.0031975949636559213, 0.0006757387325973639, 1.2256301261586535e-05, -2.0375092933492476e-05, -0.003555802757496359, 0.00018500661462061838, 3.263139419507901e-05, -3.143661022627662e-05, -0.003822253284218182, 0.00011457526617924478, 6.406800442135563e-05, -4.3364263719137674e-05, -0.004141792561351715, 0.00011037662752011649, 0.00010743226814049331, -5.636971274194804e-05, -0.004543337855361926, 0.00011825354232167018, 0.00016380198088244134, -7.071897553901503e-05, -0.005039573873056968, 0.0001300994884360608, 
0.0, 0.0, 0.0, 0.0, 0.0, -2.07975654e-06, -0.00183802608, 0.00389551218, 2.07975654e-06, -1.0176544721586535e-05, -0.0031975949636559213, 0.0006757387325973639, 1.2256301261586535e-05, -2.0375092933492476e-05, -0.003555802757496359, 0.00018500661462061838, 3.263139419507901e-05, -3.143661022627662e-05, -0.003822253284218182, 0.00011457526617924478, 6.406800442135563e-05, -4.3364263719137674e-05, -0.004141792561351715, 0.00011037662752011649, 0.00010743226814049331, -5.636971274194804e-05, -0.004543337855361926, 0.00011825354232167018, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -2.07975654e-06, -0.00183802608, 0.00389551218, 2.07975654e-06, -1.0176544721586535e-05, -0.0031975949636559213, 0.0006757387325973639, 1.2256301261586535e-05, -2.0375092933492476e-05, -0.003555802757496359, 0.00018500661462061838, 3.263139419507901e-05, -3.143661022627662e-05, -0.003822253284218182, 0.00011457526617924478, 6.406800442135563e-05, -4.3364263719137674e-05, -0.004141792561351715, 0.00011037662752011649, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -2.07975654e-06, -0.00183802608, 0.00389551218, 2.07975654e-06, -1.0176544721586535e-05, -0.0031975949636559213, 0.0006757387325973639, 1.2256301261586535e-05, -2.0375092933492476e-05, -0.003555802757496359, 0.00018500661462061838, 3.263139419507901e-05, -3.143661022627662e-05, -0.003822253284218182, 0.00011457526617924478, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -2.07975654e-06, -0.00183802608, 0.00389551218, 2.07975654e-06, -1.0176544721586535e-05, -0.0031975949636559213, 0.0006757387325973639, 1.2256301261586535e-05, -2.0375092933492476e-05, -0.003555802757496359, 0.00018500661462061838, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -2.07975654e-06, -0.00183802608, 0.00389551218, 2.07975654e-06, -1.0176544721586535e-05, -0.0031975949636559213, 0.0006757387325973639, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -2.07975654e-06, -0.00183802608, 0.00389551218, 

};
const real_t E[] = { /* Linear factor (prediction matrix) of 2-sided state constraint. */
0, 

};
const real_t Kx_Ai[] = { /* Prediction component of the state constraint bound. */
0, 

};

const real_t u_lb[] = { /* Left (lower) constraint of the inputs for condensed QP. */
-4.6234, 
-4.6234, 
-4.6234, 
-4.6234, 
-4.6234, 
-4.6234, 
-4.6234, 

};
const real_t u_ub[] = { /* Right (upper) constraint of the inputs for condensed QP. */
5.3766, 
5.3766, 
5.3766, 
5.3766, 
5.3766, 
5.3766, 
5.3766, 

};
const real_t e_lb[] = { /* Left (lower) constraint of the states for condensed QP. */
0, 

};
const real_t e_ub[] = { /* Right (upper) constraint of the states for condensed QP. */
0, 

};

const real_t nu = 0.3297065843659552; /* Fast gradient extra step constant */
const real_t mu = 0.0; /* Augmented Lagrange multiplier penalty parameter. */
const real_t Linv = 25.078405007394043; /* Inverse of gradient Lipschitz constant (1/L) */

/* state dependent variables */
real_t gxoL[MPC_HOR_INPUTS];  /* gradient vector as a function of the current state */
real_t zx_lb[MPC_HOR_MXCONSTRS];  /* mixed constraint lower bound as function of current state */
real_t zx_ub[MPC_HOR_MXCONSTRS];  /* mixed constraint upper bound as function of current state */

/* reference dependent variables */
real_t groL[MPC_HOR_INPUTS];

/* MPC system: state-space and weighting matrices */
const real_t Q[] = {  /* State weighting matrix */
200, 0, 0, 0, 
0, 1000, 0, 0, 
0, 0, 100, 0, 
0, 0, 0, 10, 

};
const real_t R[] = {   /* Input weighting matrix */
0.01, 

};
const real_t P[] = {   /* Terminal state weighting matrix */
200, 0, 0, 0, 
0, 1000, 0, 0, 
0, 0, 100, 0, 
0, 0, 0, 10, 

};
const real_t K[] = {   /* Linear quadratic regulator gain matrix */
0, 

};
const real_t Ad[] = {   /* Discrete-time system matrix */
1.0, -1.0, 0.0, 0.0, 
0.0, 1.00963139, 0.00302195789, -0.000647493758, 
0.0, 6.44332069, 1.02053755, -0.335878758, 
0.0, -0.0954516528, -0.0232225051, 0.162457879, 

};
const real_t Bd[] = {   /* Discrete-time input matrix */
0.0, 
-2.07975654e-06, 
-0.00183802608, 
0.00389551218, 

};
const real_t dt = 0.003;


/* User variables created with appropriate size */
real_t u_opt[MPC_HOR_INPUTS];  /* Optimal input */
real_t l_opt[MPC_HOR_MXCONSTRS];  /* Optimal multiplier */
real_t x_trj[MPC_HOR_STATES + MPC_STATES];  /* State trajectory for u_opt */
real_t u_ini[MPC_HOR_INPUTS];  /* Initial guess input */
real_t l_ini[MPC_HOR_MXCONSTRS];  /* Initial guess multiplier */
real_t ctl_x_ref[MPC_HOR_STATES];  /* Reference for state trajectory */
real_t ctl_u_ref[MPC_HOR_INPUTS];  /* Reference for input trajectory */

/* Always check this declarations match the structure definitions */
struct mpc_conf conf = {1, 1, 0};

struct mpc_qpx qpx = {HoL, gxoL, E, u_lb, u_ub, zx_lb, zx_ub,
		MPC_HOR_INPUTS, MPC_HOR_MXCONSTRS};

struct mpc_sys sys = {Ad, Bd, &dt};

struct mpc_wmx wmx = {Q, R, P,};

struct mpc_lqr lqr = {K, P,};

struct mpc_fgm fgm = {u_ini, gxoL, groL, &(conf.in_iter),
			HoL, GoL, Bh_T, u_lb, u_ub, &nu,
			MPC_HOR, MPC_STATES, MPC_INPUTS, MPC_HOR_INPUTS, MPC_HOR_STATES};

struct mpc_alm alm = {&fgm, l_ini, zx_lb, zx_ub, &(conf.ex_iter),
			&mu,
			E, Kx_Ai, e_lb, e_ub,
			&Linv, 
			MPC_STATES, MPC_MXCONSTRS, MPC_HOR_INPUTS, MPC_HOR_MXCONSTRS};

struct mpc_ctl ctl = {&conf, &qpx, &sys, &wmx, &lqr, &alm,
			u_opt, l_opt, x_trj, 0, 0, u_ini, l_ini};

